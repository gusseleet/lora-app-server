{
  "AWSEBDockerrunVersion": 2,
  "volumes": [
    {
      "name": "appserver",
      "host": {
        "sourcePath": "current-appserver"
      }
    },
    {
      "name": "db",
      "host": {
        "sourcePath": "/home/ec2-user/db"
      }
    },
    {
      "name": "db_ns",
      "host": {
        "sourcePath": "/home/ec2-user/db_ns"
      }
    },
    {
      "name": "redis",
      "host": {
        "sourcePath": "current-redis"
      }
    },
    {
      "name": "static_files",
      "host": {
        "sourcePath": "/home/ec2-user/staticfiles"
      }
    },
    {
      "name": "mosquitto",
      "host": {
        "sourcePath": "current-mosquitto"
      }
    },
    {
      "name": "client-ui",
      "host": {
        "sourcePath": "/home/ec2-user/client"
      }
    }
  ],
  "containerDefinitions": [

    {
      "name": "appserver",
      "image": "228684700718.dkr.ecr.eu-central-1.amazonaws.com/maliot:latest",
      "essential": true,
      "memory": 256,
      "mountPoints": [
        {
          "sourceVolume": "client-ui",
          "containerPath": "/go/src/github.com/gusseleet/lora-app-server/client"
        },
        {
          "sourceVolume": "static_files",
          "containerPath": "/go/src/github.com/gusseleet/lora-app-server/static/static"
        }
      ],
      "links": [
        "redis",
        "mosquitto",
        "postgres"
      ],
      "environment": [
        {
          "name": "LOG_LEVEL",
          "value": "5"
        },
        {
          "name": "POSTGRES_DSN",
          "value": "postgres://loraserver:loraserver@postgres/loraserver?sslmode=disable"
        },
        {
          "name": "REDIS_URL",
          "value": "redis://redis:6379"
        },
        {
          "name": "MQTT_SERVER",
          "value": "tcp://mosquitto:1883"
        },
        {
          "name": "TEST_POSTGRES_DSN",
          "value": "postgres://loraserver:loraserver@postgres/loraserver?sslmode=disable"
        },
        {
          "name": "TEST_REDIS_URL",
          "value": "redis://redis:6379"
        },
        {
          "name": "TEST_MQTT_SERVER",
          "value": "tcp://mosquitto:1883"
        },
        {
          "name": "JWT_SECRET",
          "value": "verysecret"
        },
        {
          "name": "HTTP_TLS_CERT",
          "value": "/etc/lora-app-server/certs/http.pem"
        },
        {
          "name": "HTTP_TLS_KEY",
          "value": "/etc/lora-app-server/certs/http-key.pem"
        },
        {
          "name": "AS_PUBLIC_SERVER",
          "value": "appserver:8001"
        },
        {
          "name": "DB_AUTOMIGRATE",
          "value": "true"
        }
      ],
      "command": [
        "make",
        "serve"
      ],
      "portMappings": [
        {
          "hostPort": 8080,
          "containerPort": 8080
        }
      ]
    },

    {
      "name": "postgres",
      "image": "postgres:9.5",
      "essential": true,
      "memory": 128,
      "environment": [
        {
          "name": "POSTGRES_PASSWORD",
          "value": "loraserver"
        },
        {
          "name": "POSTGRES_USER",
          "value": "loraserver"
        },
        {
          "name": "POSTGRES_DB",
          "value": "loraserver"
        }
      ],
      "command": [],
      "portMappings": [],
      "mountPoints": [
        {
          "sourceVolume": "db",
          "containerPath": "/var/lib/postgresql/data"
        }
      ]
    },
    {
      "name": "postgres_ns",
      "image": "postgres:9.5",
      "essential": true,
      "memory": 128,
      "environment": [
        {
          "name": "POSTGRES_PASSWORD",
          "value": "loraserver_ns"
        },
        {
          "name": "POSTGRES_USER",
          "value": "loraserver_ns"
        },
        {
          "name": "POSTGRES_DB",
          "value": "loraserver_ns"
        }
      ],
      "command": [],
      "portMappings": [],
      "mountPoints": [
        {
          "sourceVolume": "db_ns",
          "containerPath": "/var/lib/postgresql/data"
        }
      ]
    },
    {
      "name": "redis",
      "image": "redis:3.0.7-alpine",
      "essential": true,
      "memory": 128,
      "portMappings": [
        {
          "hostPort": 6379,
          "containerPort": 6379
        }
      ],
      "links": [],
      "mountPoints": []
    },
    {
      "name": "mosquitto",
      "image": "ansi/mosquitto",
      "essential": true,
      "memory": 128,
      "portMappings": [
        {
          "hostPort": 1883,
          "containerPort": 1883
        }
      ],
      "links": [],
      "mountPoints": [

      ]
    },
    {
      "name": "gateway_bridge",
      "image": "loraserver/lora-gateway-bridge",
      "essential": true,
      "memory": 256,
      "environment": [
        {
          "name": "MQTT_SERVER",
          "value": "tcp://mosquitto:1883"
        }
      ],
      "command": [],
      "portMappings": [
        {
          "hostPort": 1700,
          "containerPort": 1700,
          "protocol": "udp"
        }
      ],
      "mountPoints": [],
      "links": [
        "mosquitto"
      ]
    },
    {
      "name": "loraserver",
      "image": "loraserver/loraserver",
      "essential": true,
      "memory": 128,
      "portMappings": [
        {
          "hostPort": 8000,
          "containerPort": 8000
        }
      ],
      "links": [
        "postgres_ns",
        "mosquitto",
        "redis",
        "appserver"
      ],
      "mountPoints": [],
      "environment": [
        {
          "name": "DB_AUTOMIGRAT",
          "value": "true"
        },
        {
          "name": "LOG_LEVEL",
          "value": "4"
        },
        {
          "name": "LOG_NODE_FRAMES",
          "value": "true"
        },
        {
          "name": "NET_ID",
          "value": "010203"
        },
        {
          "name": "BAND",
          "value": "EU_863_870"
        },
        {
          "name": "REDIS_URL",
          "value": "redis://redis:6379"
        },
        {
          "name": "GW_MQTT_SERVER",
          "value": "tcp://mosquitto:1883"
        },
        {
          "name": "GW_SERVER_JWT_SECRET",
          "value": "verysecret"
        },
        {
          "name": "POSTGRES_DSN",
          "value": "postgres://loraserver_ns:loraserver_ns@postgres_ns/loraserver_ns?sslmode=disable"
        },
        {
          "name": "JS_SERVER",
          "value": "http://appserver:8003"
        }
      ]
    }

  ]
}